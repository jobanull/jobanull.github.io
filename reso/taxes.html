<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aplikasi Hitung Pajak Penghasilan (PPh21 + BPJS)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#06b6d4;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{margin:0;background:linear-gradient(180deg,#071029 0%, #081424 100%);color:#e6eef6;padding:28px}
    .app{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);margin-bottom:14px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    .row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .row-2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .controls{display:flex;gap:10px;align-items:center}
    button{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;background:var(--accent);color:#052023}
    .muted-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .result{display:flex;gap:12px;flex-wrap:wrap}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;min-width:180px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
    th{color:var(--muted);font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:10px;color:var(--muted);font-size:13px}
    @media(max-width:820px){.row{grid-template-columns:1fr}.row-2{grid-template-columns:1fr}.stat{min-width:100%}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Aplikasi Hitung Pajak Penghasilan</h1>
      <div class="small">Menghitung PPh21 (sederhana), iuran BPJS Kesehatan &amp; Ketenagakerjaan.</div>
    </header>

    <!-- Input Section -->
    <section class="card">
      <div class="row">
        <div>
          <label>Gaji pokok + tunjangan tetap (Rp / bulan)</label>
          <input id="salary" type="number" value="12000000" min="0" />
        </div>
        <div>
          <label>Tunjangan tidak tetap / rata2 (Rp / bulan)</label>
          <input id="allowance" type="number" value="0" min="0" />
        </div>
        <div>
          <label>Bonus / THR (estimasi per tahun)</label>
          <input id="bonus" type="number" value="0" min="0" />
        </div>
      </div>

      <div style="margin-top:10px" class="row-2">
        <div>
          <label>Status PTKP</label>
          <select id="ptkp">
            <option value="TK0">TK/0</option>
            <option value="TK1">TK/1</option>
            <option value="TK2">TK/2</option>
            <option value="TK3">TK/3</option>
            <option value="K0" selected>K/0</option>
            <option value="K1">K/1</option>
            <option value="K2">K/2</option>
            <option value="K3">K/3</option>
          </select>
        </div>
        <div>
          <label>BPJS: ikut BPJS Kesehatan?</label>
          <select id="bpjsHealth">
            <option value="yes">Ya</option>
            <option value="no">Tidak</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px" class="controls">
        <button id="calc">Hitung</button>
        <button id="reset" class="muted-btn">Reset</button>
        <button id="export" class="muted-btn">Salin CSV</button>
      </div>
    </section>

    <!-- Output Section -->
    <section id="output" class="card">
      <div class="result">
        <div class="stat">
          <div class="small">Upah per bulan</div>
          <div id="outSalary" style="font-weight:700;font-size:18px">Rp 0</div>
        </div>
        <div class="stat">
          <div class="small">Total Potongan (per bulan)</div>
          <div id="outDeduction" style="font-weight:700;font-size:18px">Rp 0</div>
        </div>
        <div class="stat">
          <div class="small">Pendapatan Netto (take-home pay)</div>
          <div id="outNetto" style="font-weight:700;font-size:18px">Rp 0</div>
        </div>
      </div>

      <div id="breakdownArea" style="margin-top:12px">
        <table id="breakdown">
          <thead>
            <tr><th>Item</th><th>Per bulan (Rp)</th><th>Per tahun (Rp)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <footer>
        <strong>Catatan:</strong> Default rate yang dipakai (dapat diubah di kode):<br>
        • BPJS Kesehatan: employer 4%, employee 1%, plafon upah Rp12 juta.<br>
        • BPJS Ketenagakerjaan: JHT 5.7% (3.7% + 2%); JP 3% (2% + 1%).<br>
        • PTKP sesuai ketentuan (TK/0 = Rp54 juta, K/0 = Rp58,5 juta dst).<br>
        • PPh21 dihitung pakai tarif progresif Pasal 17 (sederhana).
      </footer>
    </section>
  </div>

  <script>
    const fmt = n => 'Rp ' + Math.round(n||0).toLocaleString('id-ID');
    const $ = id => document.getElementById(id);

    const RATES = {
      bpjsHealth: { employeePct: 0.01, wageCap: 12000000 },
      bpjsKetenagakerjaan: { JHT_employee: 0.02, JP_employee: 0.01 },
      biayaJabatanPct: 0.05, biayaJabatanCapPerYear: 6000000,
      ptkpMap: {
        'TK0': 54000000,'TK1': 58500000,'TK2': 63000000,'TK3': 67500000,
        'K0': 58500000,'K1': 63000000,'K2': 67500000,'K3': 72000000
      },
      taxBrackets: [
        { upTo: 60000000, rate: 0.05 },
        { upTo: 250000000, rate: 0.15 },
        { upTo: 500000000, rate: 0.25 },
        { upTo: Infinity, rate: 0.30 },
      ]
    };

    function calc(){
      const salary = +$('salary').value||0;
      const allowance = +$('allowance').value||0;
      const bonus = +$('bonus').value||0;
      const ptkp = RATES.ptkpMap[$('ptkp').value];
      const useBpjs = $('bpjsHealth').value==='yes';

      const grossMonthly = salary+allowance;
      const grossYearly = grossMonthly*12+bonus;

      const bpjsHealth = useBpjs ? Math.min(grossMonthly,RATES.bpjsHealth.wageCap)*RATES.bpjsHealth.employeePct : 0;
      const jht = grossMonthly*RATES.bpjsKetenagakerjaan.JHT_employee;
      const jp  = grossMonthly*RATES.bpjsKetenagakerjaan.JP_employee;

      const biayaJabatan = Math.min(grossYearly*RATES.biayaJabatanPct,RATES.biayaJabatanCapPerYear);
      const iuranPensiun = jp*12;
      const netYearly = grossYearly-biayaJabatan-iuranPensiun;

      let pkp = netYearly-ptkp;
      pkp = pkp<=0?0:Math.floor(pkp/1000)*1000;

      let remaining=pkp, pajak=0, lower=0;
      for(const br of RATES.taxBrackets){
        const taxable=Math.min(remaining,br.upTo-lower);
        pajak+=taxable*br.rate; remaining-=taxable; lower=br.upTo;
        if(remaining<=0) break;
      }

      const pph = pajak/12;
      const totalPotongan = bpjsHealth+jht+jp+pph;
      const netto = grossMonthly-totalPotongan;

      // update breakdown
      const tbody=$('#breakdown tbody'); tbody.innerHTML='';
      const rows=[
        ['Gaji + tunjangan (gross)',fmt(grossMonthly),fmt(grossYearly)],
        ['BPJS Kesehatan (karyawan)',fmt(bpjsHealth),fmt(bpjsHealth*12)],
        ['JHT (karyawan)',fmt(jht),fmt(jht*12)],
        ['JP (karyawan)',fmt(jp),fmt(jp*12)],
        ['Biaya jabatan',"-",fmt(biayaJabatan)],
        ['Iuran pensiun (JP)',"-",fmt(iuranPensiun)],
        ['Penghasilan neto (tahun)',"-",fmt(netYearly)],
        ['PTKP',"-",fmt(ptkp)],
        ['PKP',"-",fmt(pkp)],
        ['PPh21 terhutang (tahun)',"-",fmt(pajak)],
        ['PPh21 potong (bulan)',fmt(pph),fmt(pph*12)],
        ['Total potongan (bulan)',fmt(totalPotongan),fmt(totalPotongan*12)],
        ['Pendapatan Netto (take-home)',fmt(netto),fmt(netto*12)]
      ];
      rows.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>`;
        tbody.appendChild(tr);
      });

      // update cards
      $('outSalary').textContent=fmt(grossMonthly);
      $('outDeduction').textContent=fmt(totalPotongan);
      $('outNetto').textContent=fmt(netto);
    }

    $('calc').onclick=calc;
    $('reset').onclick=()=>{ $('salary').value=12000000; $('allowance').value=0; $('bonus').value=0; $('ptkp').value='K0'; $('bpjsHealth').value='yes'; calc(); };
    $('export').onclick=()=>{ alert("Export CSV bisa ditambah di bagian script sesuai kebutuhan."); };

    calc();
  </script>
</body>
</html>
