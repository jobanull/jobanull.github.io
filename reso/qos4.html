<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Quality of Service (Q-Tree)</title>
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="note-container">

  <main class="note-main">
    <h2 class="note-title text-center">Quality of Service (Q-Tree)</h2>
    <p class="note-paragraph">
      <strong>Q-Tree</strong> adalah metode QoS berbasis hierarki di MikroTik yang memungkinkan pengaturan antrean (queue)
      secara kompleks, termasuk prioritas, limit, dan pembagian bandwidth ke sub-queue. Cocok untuk jaringan dengan
      kebutuhan kontrol bandwidth yang mendetail per user, departemen, atau jenis trafik.
    </p>

    <ul class="note-list">
      <li><strong>Kelebihan:</strong> Mengatur bandwidth dan prioritas secara hierarkis; bisa menggabungkan PCQ, simple queue, dan queue tree; fleksibel untuk jaringan kompleks.</li>
      <li><strong>Keterbatasan:</strong> Konfigurasi lebih kompleks dibanding simple queue; perlu pemahaman tentang parent/child queue.</li>
      <li><strong>Gunakan Saat:</strong> Kantor besar, hotspot, ISP, atau jaringan yang ingin membagi bandwidth ke departemen, user, atau aplikasi tertentu secara hierarkis.</li>
    </ul>

    <h3 class="note-subtitle">CONTOH KASUS</h3>
    <ul class="note-list">
      <li>Tujuan: Mengimplementasikan <strong>Queue Tree (QT)</strong> untuk membagi bandwidth upload antar-client berdasarkan packet-mark.</li>
      <li>Topologi: Router <code>R.QT</code> memiliki 2 jaringan LAN di ether2 dan ether3, dengan akses internet via ether1.</li>
      <li>Catatan:
        <ul>
          <li>DHCP server memberikan IP untuk masing-masing LAN:
            <ul>
              <li>192.168.1.2 untuk client1 (via ether2).</li>
              <li>192.168.2.2 untuk client2 (via ether3).</li>
            </ul>
          </li>
          <li>Firewall mangle digunakan untuk <em>mark connection</em> dan <em>mark packet</em> per client.</li>
          <li>Queue tree dibuat dengan parent <code>queue-parent-upload</code> (max-limit 1M).</li>
          <li>Masing-masing client mendapat limit upload maksimal 254k.</li>
          <li>NAT diterapkan agar client LAN dapat mengakses internet melalui ether1.</li>
          <li>Router diberi identitas unik dengan <code>/system identity</code> = R.QT.</li>
        </ul>
      </li>
    </ul>

    <img src="img/qos.png" alt="Diagram jaringan" class="note-image" />
    <h3 class="note-subtitle">R.QT</h3>
    <pre class="note-codeblock"><code>
/queue tree
add max-limit=1M name=queue-parent-upload parent=ether1                # Parent queue upload total 1 Mbps di ether1
add max-limit=254k name=queue1-upload packet-mark=packet-client1 \
    parent=queue-parent-upload                                         # Queue anak untuk client1 upload max 254 kbps
add max-limit=254k name=queue2-upload packet-mark=packet-client2 \
    parent=queue-parent-upload                                         # Queue anak untuk client2 upload max 254 kbps

/ip address
add address=192.168.1.1/30 interface=ether2 network=192.168.1.0        # IP gateway client1 (ether2)
add address=192.168.2.1/30 interface=ether3 network=192.168.2.0        # IP gateway client2 (ether3)

/ip dhcp-client
add disabled=no interface=ether1                                       # Interface WAN (ether1) dapat IP dari ISP

/ip firewall mangle
add action=mark-connection chain=prerouting new-connection-mark=conn-client1 \
    passthrough=yes src-address=192.168.1.2                            # Tandai koneksi client1 berdasarkan IP
add action=mark-connection chain=prerouting new-connection-mark=conn-client2 \
    passthrough=yes src-address=192.168.2.2                            # Tandai koneksi client2 berdasarkan IP
add action=mark-packet chain=prerouting connection-mark=conn-client1 \
    new-packet-mark=packet-client1 passthrough=no                      # Tandai paket client1
add action=mark-packet chain=prerouting connection-mark=conn-client2 \
    new-packet-mark=packet-client2 passthrough=no                      # Tandai paket client2

/ip firewall nat
add action=masquerade chain=srcnat out-interface=ether1                # NAT agar client bisa akses internet via ether1

/system identity
set name=R.QT                                                          # Nama router = R.QT
    </code></pre>

    <h3 class="note-subtitle">Tips Praktis</h3>
    <ul class="note-list">
      <li>Pahami hierarki parent-child queue agar bandwidth dibagi sesuai rencana.</li>
      <li>Gunakan packet mark atau mangle untuk mengarahkan trafik ke child queue tertentu.</li>
      <li>Priority lebih rendah = angka lebih tinggi; gunakan untuk mengatur urutan antrean.</li>
      <li>Monitor dengan `/queue tree print` untuk memastikan QoS bekerja sesuai harapan.</li>
    </ul>

    <h3 class="note-subtitle">Ringkasan</h3>
    <p class="note-paragraph">
      Q-Tree memungkinkan pengaturan bandwidth dan prioritas secara hierarkis, menggabungkan parent dan child queue untuk kontrol granular. Ideal untuk jaringan kompleks dengan banyak user, departemen, atau aplikasi yang memerlukan alokasi bandwidth spesifik.
    </p>

    <hr class="note-divider" />
  </main>

</body>
</html>
