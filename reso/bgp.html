<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Border Gateway Protocol (BGP)</title>
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="note-container">

  <main class="note-main">
    <h2 class="note-title text-center">Border Gateway Protocol (BGP)</h2>
    <p class="note-paragraph">
      Border Gateway Protocol (BGP) adalah protokol routing yang digunakan untuk bertukar informasi rute antar 
      <em>Autonomous System</em> (AS) di internet. BGP termasuk kategori <strong>path vector protocol</strong> 
      yang mengandalkan <em>policy-based routing</em> untuk memilih jalur terbaik, bukan sekadar metrik teknis.
      BGP berjalan di atas TCP port 179 sehingga komunikasi antar router bersifat andal dan terkontrol.
    </p>

    <h3 class="note-subtitle">Peran dan Fungsi BGP</h3>
    <ul class="note-list">
      <li>Memilih jalur terbaik untuk mencapai jaringan tujuan berdasarkan kebijakan.</li>
      <li>Menghubungkan jaringan antar-AS di internet.</li>
      <li>Memberikan kontrol penuh terhadap rute yang diumumkan atau diterima.</li>
      <li>Menangani skala besar (puluhan ribu hingga jutaan rute).</li>
    </ul>

    <h3 class="note-subtitle">Jenis BGP</h3>
    <ul class="note-list">
      <li><strong>EBGP (External BGP)</strong> - Digunakan untuk pertukaran rute antar-AS yang berbeda.</li>
      <li><strong>IBGP (Internal BGP)</strong> - Digunakan untuk pertukaran rute antar-router dalam AS yang sama.</li>
    </ul>

    <h3 class="note-subtitle">Atribut Penting BGP</h3>
    <p class="note-paragraph">
      BGP menggunakan sejumlah atribut untuk menentukan jalur terbaik. Beberapa yang paling umum:
    </p>
    <ul class="note-list">
      <li><strong>Weight</strong> - Atribut lokal pada router Cisco, nilai lebih besar lebih diutamakan.</li>
      <li><strong>Local Preference (LOCAL_PREF)</strong> - Menentukan preferensi jalur keluar dalam satu AS; nilai lebih tinggi lebih diutamakan.</li>
      <li><strong>AS Path</strong> - Menyimpan urutan AS yang dilewati; jalur terpendek biasanya diutamakan.</li>
      <li><strong>Multi-Exit Discriminator (MED)</strong> - Memberi sinyal jalur keluar yang diinginkan kepada AS tetangga.</li>
      <li><strong>Next Hop</strong> - Menentukan alamat router berikut yang harus dilalui paket untuk mencapai tujuan.</li>
    </ul>

    <h3 class="note-subtitle">BGP Prepend</h3>
    <p class="note-paragraph">
      <strong>BGP Prepend</strong> (atau <em>AS Path Prepending</em>) adalah teknik untuk mengontrol <em>incoming traffic</em> 
      dengan cara menambahkan nomor AS kita berulang kali pada atribut <strong>AS Path</strong> ketika mengiklankan rute. 
      Tujuannya adalah membuat jalur tersebut terlihat lebih panjang sehingga router lain di internet akan lebih memilih 
      jalur alternatif yang lebih pendek.
    </p>
    <p class="note-paragraph">
      Contoh: Jika sebuah prefix diiklankan dengan AS Path <code>65001</code>, maka dengan prepend dapat diubah menjadi 
      <code>65001 65001 65001</code>. Router tetangga akan menganggap jalur ini lebih panjang dan cenderung memilih jalur lain 
      jika tersedia.
    </p>

    <h3 class="note-subtitle">Kelebihan BGP</h3>
    <ul class="note-list">
      <li>Kontrol routing yang sangat fleksibel.</li>
      <li>Mendukung multi-homing dan redundansi koneksi.</li>
      <li>Skalabilitas tinggi untuk jaringan berskala global.</li>
      <li>Dapat mengimplementasikan kebijakan keamanan dan filtering rute.</li>
    </ul>

    <h3 class="note-subtitle">Kekurangan BGP</h3>
    <ul class="note-list">
      <li>Konfigurasi dan pemeliharaan relatif kompleks.</li>
      <li>Konsvergensi (waktu stabil) lebih lambat dibanding protokol routing internal seperti OSPF atau EIGRP.</li>
      <li>Sangat bergantung pada kebijakan dan pengaturan manual oleh administrator.</li>
    </ul>


     <h3 class="note-subtitle">CONTOH KASUS</h3>
      <ul class="note-list">
        <li>Tujuan: Mengonfigurasi <strong>BGP dan filter</strong> agar <strong>PC 1 hanya bisa melakukan ping ke PC2</strong>.</li>
        <li>Filter BGP: RB4 menerima route hanya ke PC2 dan mengiklankan route hanya ke PC1.</li>
        <li>Catatan:  
          <ul>
            <li>RB1: ASN 64112, mengiklankan jaringan link ke RB2 & RB3.</li>
            <li>RB2 & RB3: Router transit, mengatur route ke RB4 & RB5.</li>
            <li>RB4: ASN 64111, filter masuk hanya menerima prefix PC2, filter keluar hanya mengiklankan PC1.</li>
            <li>RB5: ASN 64113, mengiklankan jaringan PC2 & PC3.</li>
          </ul>
        </li>
      </ul>


       <img src="img/bgp1.png" alt="Diagram jaringan" class="note-image" />
       <p class="note-subtitle">RB1</p>
    <pre class="note-codeblock"><code>
/routing bgp instance
set default as=64112                    # Set Autonomous System Number (ASN) RB1 = 64112

/ip address
add address=10.1.1.1/30 interface=ether2 network=10.1.1.0   # IP link ke RB2
add address=11.1.1.1/30 interface=ether3 network=11.1.1.0   # IP link ke RB3

/ip dhcp-client
add disabled=no interface=ether1                           # Dapatkan IP dari ISP/internet di ether1

/ip firewall nat
add action=masquerade chain=srcnat out-interface=ether1    # NAT keluar ke internet

/ip route
add distance=1 dst-address=12.1.1.0/30 gateway=10.1.1.2     # Route menuju RB4 via RB2
add distance=1 dst-address=13.1.1.0/30 gateway=11.1.1.2     # Route menuju RB5 via RB3

/routing bgp network
add network=10.1.1.0/30 synchronize=no   # Iklankan network 10.1.1.0/30 ke BGP
add network=11.1.1.0/30 synchronize=no   # Iklankan network 11.1.1.0/30 ke BGP

/routing bgp peer
add multihop=yes name=peer1 remote-address=12.1.1.2 remote-as=64111   # BGP ke RB4
add multihop=yes name=peer2 remote-address=13.1.1.2 remote-as=64113   # BGP ke RB5

/system identity
set name=RB1                             # Set nama router

    </code></pre>
    
       <p class="note-subtitle">RB2</p>
    <pre class="note-codeblock"><code>
/ip address
add address=10.1.1.2/30 interface=ether1 network=10.1.1.0    # Link ke RB1
add address=12.1.1.1/30 interface=ether2 network=12.1.1.0    # Link ke RB4

/ip route
add distance=1 gateway=10.1.1.1                             # Default route via RB1
add distance=1 dst-address=192.168.1.0/30 gateway=12.1.1.2   # Route ke PC1 di RB4

/system identity
set name=RB2

    </code></pre>

       <p class="note-subtitle">RB3</p>
    <pre class="note-codeblock"><code>
/ip address
add address=11.1.1.2/30 interface=ether1 network=11.1.1.0    # Link ke RB1
add address=13.1.1.1/30 interface=ether2 network=13.1.1.0    # Link ke RB5

/ip route
add distance=1 gateway=11.1.1.1                             # Default route via RB1
add distance=1 dst-address=192.168.2.0/30 gateway=13.1.1.2   # Route ke PC2 di RB5
add distance=1 dst-address=192.168.3.0/30 gateway=13.1.1.2   # Route ke jaringan lain di RB5

/system identity
set name=RB3

    </code></pre>

       <p class="note-subtitle">R.Cisco</p>
    <pre class="note-codeblock"><code>
interface FastEthernet0/0
 ip address 12.1.1.2 255.255.255.252    # IP link ke RB2
 duplex auto
 speed auto
!
interface FastEthernet1/0
 ip address 192.168.1.1 255.255.255.252 # Jaringan PC1
 duplex auto
 speed auto
!
router bgp 64111                        # ASN RB4 = 64111
 bgp log-neighbor-changes
 network 192.168.1.0 mask 255.255.255.252   # Iklankan jaringan PC1
 neighbor 10.1.1.1 remote-as 64112          # BGP peer ke RB1 (ASN 64112)
 neighbor 10.1.1.1 ebgp-multihop 2          # Aktifkan multihop BGP
 no auto-summary
!
ip route 10.1.1.0 255.255.255.252 12.1.1.1  # Static route ke RB1 via RB2
!
hostname RB4                               # Set nama router

    </code></pre>

       <p class="note-subtitle">R.Juniper</p>
    <pre class="note-codeblock"><code>
interfaces {
    em2 {
        unit 0 {
            family inet {
                address 192.168.2.1/30;   # Jaringan PC2
            }
        }
    }
    fxp0 {
        unit 0 {
            family inet {
                address 13.1.1.2/30;      # IP link ke RB3
            }
        }
    }
}

routing-options {
    static {
        route 11.1.1.0/30 next-hop 13.1.1.1;   # Static route ke RB1 via RB3
    }
    autonomous-system 64113;                   # ASN RB5 = 64113
}

protocols {
    bgp {
        group EBGP-MH {
            type external;
            multihop {
                ttl 10;                        # Aktifkan multihop BGP
            }
            export EXPORT-LAN;                 # Export policy untuk LAN
            peer-as 64112;                     # ASN tetangga = RB1
            neighbor 11.1.1.1 {                # BGP peer ke RB1
                local-address 13.1.1.2;        # Gunakan IP link ke RB3
            }
        }
    }
}

policy-options {
    policy-statement EXPORT-LAN {
        term 1 {
            from {
                route-filter 192.168.2.0/30 exact;   # Iklankan PC2
            }
            then accept;
        }
        then reject;                                # Tolak prefix lain
    }
}
    </code></pre>

    <h3 class="note-subtitle">Verifikasi BGP</h3>

    <h3 class="note-subtitle">R.Mikrotik</h3>
    <pre class="note-codeblock"><code>
[admin@RB1] > routing bgp peer print status 
Flags: X - disabled, E - established 
 0 E name="BGP-R.Cisco" instance=default remote-address=12.1.1.2 
     remote-as=64111 tcp-md5-key="" nexthop-choice=default multihop=yes 
     route-reflect=no hold-time=3m ttl=255 in-filter="" out-filter="" 
     address-families=ip default-originate=never remove-private-as=no 
     as-override=no passive=no use-bfd=no remote-id=192.168.1.1 
     local-address=10.1.1.1 uptime=6m11s prefix-count=1 updates-sent=5 
     updates-received=1 withdrawn-sent=0 withdrawn-received=0 
     remote-hold-time=3m used-hold-time=3m used-keepalive-time=1m 
     refresh-capability=yes state=established 

 1 E name="BGP-R.Juniper" instance=default remote-address=13.1.1.2 
     remote-as=64113 tcp-md5-key="" nexthop-choice=default multihop=yes 
     route-reflect=no hold-time=3m ttl=255 in-filter="" out-filter="" 
     address-families=ip default-originate=never remove-private-as=no 
     as-override=no passive=no use-bfd=no remote-id=13.1.1.2 
     local-address=11.1.1.1 uptime=4m4s prefix-count=1 updates-sent=5 
     updates-received=1 withdrawn-sent=0 withdrawn-received=0 
     remote-hold-time=1m30s used-hold-time=1m30s used-keepalive-time=30s 
     refresh-capability=yes as4-capability=yes state=established 
[admin@RB1] > routing bgp advertisements print 
PEER     PREFIX               NEXTHOP          AS-PATH    ORIGIN     LOCAL-PREF
peer1    11.1.1.0/30          10.1.1.1                    igp       
peer1    10.1.1.0/30          10.1.1.1                    igp       
peer1    192.168.2.0/30       10.1.1.1         64113      igp       
peer2    192.168.1.0/30       11.1.1.1         64111      igp       
peer2    11.1.1.0/30          11.1.1.1                    igp       
peer2    10.1.1.0/30          11.1.1.1                    igp       
[admin@RB1] > ip route print where bgp
Flags: X - disabled, A - active, D - dynamic, 
C - connect, S - static, r - rip, b - bgp, o - ospf, m - mme, 
B - blackhole, U - unreachable, P - prohibit 
 #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0 ADb  192.168.1.0/30                     12.1.1.2                 20
 1 ADb  192.168.2.0/30                     13.1.1.2                 20
    </code></pre>
   
    <h3 class="note-subtitle">R.Cisco</h3>
    <pre class="note-codeblock"><code>

R-Cisco#show ip bgp summary 
BGP router identifier 192.168.1.1, local AS number 64111
BGP table version is 6, main routing table version 6
4 network entries using 468 bytes of memory
4 path entries using 208 bytes of memory
4/3 BGP path/bestpath attribute entries using 496 bytes of memory
2 BGP AS-PATH entries using 48 bytes of memory
0 BGP route-map cache entries using 0 bytes of memory
0 BGP filter-list cache entries using 0 bytes of memory
BGP using 1220 total bytes of memory
BGP activity 4/0 prefixes, 4/0 paths, scan interval 60 secs

Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
10.1.1.1        4 64112    3133    2732        6    0    0 1d21h           3
R-Cisco#show ip bgp neighbors 10.1.1.1 received-routes 
BGP table version is 6, local router ID is 192.168.1.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal,
              r RIB-failure, S Stale
Origin codes: i - IGP, e - EGP, ? - incomplete

   Network          Next Hop            Metric LocPrf Weight Path
r> 10.1.1.0/30      10.1.1.1                               0 64112 i
*> 11.1.1.0/30      10.1.1.1                               0 64112 i
*> 192.168.2.0/30   10.1.1.1                               0 64112 64113 i

Total number of prefixes 3 
R-Cisco#show ip bgp neighbors 10.1.1.1 advertised-routes
BGP table version is 6, local router ID is 192.168.1.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal,
              r RIB-failure, S Stale
Origin codes: i - IGP, e - EGP, ? - incomplete

   Network          Next Hop            Metric LocPrf Weight Path
*> 192.168.1.0/30   0.0.0.0                  0         32768 i

Total number of prefixes 1 
R-Cisco#show ip bgp
BGP table version is 6, local router ID is 192.168.1.1
Status codes: s suppressed, d damped, h history, * valid, > best, i - internal,
              r RIB-failure, S Stale
Origin codes: i - IGP, e - EGP, ? - incomplete

   Network          Next Hop            Metric LocPrf Weight Path
r> 10.1.1.0/30      10.1.1.1                               0 64112 i
*> 11.1.1.0/30      10.1.1.1                               0 64112 i
*> 192.168.1.0/30   0.0.0.0                  0         32768 i
*> 192.168.2.0/30   10.1.1.1                               0 64112 64113 i
R-Cisco#show ip route bgp
     11.0.0.0/30 is subnetted, 1 subnets
B       11.1.1.0 [20/0] via 10.1.1.1, 1d21h
     192.168.2.0/30 is subnetted, 1 subnets
B       192.168.2.0 [20/0] via 10.1.1.1, 1d21h
    </code></pre>
   
    <h3 class="note-subtitle">R.Juniper</h3>
    <pre class="note-codeblock"><code>
root@R1.VMX> show bgp summary                                
Groups: 1 Peers: 1 Down peers: 0
Table          Tot Paths  Act Paths Suppressed    History Damp State    Pending
inet.0               
                       3          2          0          0          0          0
Peer                     AS      InPkt     OutPkt    OutQ   Flaps Last Up/Dwn State|#Active/Received/Accepted/Damped...
11.1.1.1              64112         35         35       0       0       14:12 2/3/3/0              0/0/0/0

root@R1.VMX> show bgp neighbor                               
Peer: 11.1.1.1+179 AS 64112    Local: 13.1.1.2+50514 AS 64113
  Type: External    State: Established    Flags: <Sync>
  Last State: OpenConfirm   Last Event: RecvKeepAlive
  Last Error: None
  Export: [ EXPORT-LAN ] 
  Options: <Multihop Preference LocalAddress Ttl PeerAS Refresh>
  Local Address: 13.1.1.2 Holdtime: 90 Preference: 170
  Number of flaps: 0
  Peer ID: 10.1.1.1        Local ID: 13.1.1.2          Active Holdtime: 90
  Keepalive Interval: 30         Group index: 0    Peer index: 0   
  BFD: disabled, down
  NLRI for restart configured on peer: inet-unicast
  NLRI advertised by peer: inet-unicast
  NLRI for this session: inet-unicast
  Peer supports Refresh capability (2)
  Stale routes from peer are kept for: 300
  Peer does not support Restarter functionality
  Peer does not support Receiver functionality
  Peer supports 4 byte AS extension (peer-as 64112)
  Peer does not support Addpath
  Table inet.0 Bit: 10000
    RIB State: BGP restart is complete
    Send state: in sync
---(backing up)---                      
Peer: 11.1.1.1+179 AS 64112    Local: 13.1.1.2+50514 AS 64113
  Type: External    State: Established    Flags: <Sync>
  Last State: OpenConfirm   Last Event: RecvKeepAlive
  Last Error: None
  Export: [ EXPORT-LAN ] 
  Options: <Multihop Preference LocalAddress Ttl PeerAS Refresh>
  Local Address: 13.1.1.2 Holdtime: 90 Preference: 170
  Number of flaps: 0
  Peer ID: 10.1.1.1        Local ID: 13.1.1.2          Active Holdtime: 90
  Keepalive Interval: 30         Group index: 0    Peer index: 0   
  BFD: disabled, down
  NLRI for restart configured on peer: inet-unicast
  NLRI advertised by peer: inet-unicast
  NLRI for this session: inet-unicast
  Peer supports Refresh capability (2)
  Stale routes from peer are kept for: 300
  Peer does not support Restarter functionality
  Peer does not support Receiver functionality
  Peer supports 4 byte AS extension (peer-as 64112)
  Peer does not support Addpath
  Table inet.0 Bit: 10000
    RIB State: BGP restart is complete
    Send state: in sync
---(backing up)---                      
Peer: 11.1.1.1+179 AS 64112    Local: 13.1.1.2+50514 AS 64113
  Type: External    State: Established    Flags: <Sync>
  Last State: OpenConfirm   Last Event: RecvKeepAlive
  Last Error: None
  Export: [ EXPORT-LAN ] 
  Options: <Multihop Preference LocalAddress Ttl PeerAS Refresh>
  Local Address: 13.1.1.2 Holdtime: 90 Preference: 170
  Number of flaps: 0
  Peer ID: 10.1.1.1        Local ID: 13.1.1.2          Active Holdtime: 90
  Keepalive Interval: 30         Group index: 0    Peer index: 0   
  BFD: disabled, down
  NLRI for restart configured on peer: inet-unicast
  NLRI advertised by peer: inet-unicast
  NLRI for this session: inet-unicast
  Peer supports Refresh capability (2)
  Stale routes from peer are kept for: 300
  Peer does not support Restarter functionality
  Peer does not support Receiver functionality
  Peer supports 4 byte AS extension (peer-as 64112)
  Peer does not support Addpath
  Table inet.0 Bit: 10000
    RIB State: BGP restart is complete
    Send state: in sync
    Active prefixes:              2     
    Received prefixes:            3
    Accepted prefixes:            3
    Suppressed due to damping:    0
    Advertised prefixes:          1
  Last traffic (seconds): Received 7    Sent 21   Checked 47  
  Input messages:  Total 35	Updates 3	Refreshes 0 	Octets 766
  Output messages: Total 35	Updates 1	Refreshes 0 	Octets 734
  Output Queue[0]: 0

root@R1.VMX> show route receive-protocol bgp 11.1.1.1        

inet.0: 7 destinations, 8 routes (7 active, 0 holddown, 0 hidden)
  Prefix		  Nexthop	       MED     Lclpref    AS path
* 10.1.1.0/30             11.1.1.1                                64112 I
  11.1.1.0/30             11.1.1.1                                64112 I
* 192.168.1.0/30          11.1.1.1                                64112 64111 I

root@R1.VMX> show route advertising-protocol bgp 11.1.1.1    

inet.0: 7 destinations, 8 routes (7 active, 0 holddown, 0 hidden)
  Prefix		  Nexthop	       MED     Lclpref    AS path
* 192.168.2.0/30          Self                                    I

root@R1.VMX> show route protocol bgp                         

inet.0: 7 destinations, 8 routes (7 active, 0 holddown, 0 hidden)
+ = Active Route, - = Last Active, * = Both

10.1.1.0/30        *[BGP/170] 00:14:28, localpref 100, from 11.1.1.1
                      AS path: 64112 I, validation-state: unverified
                    > to 13.1.1.1 via fxp0.0
11.1.1.0/30         [BGP/170] 00:14:28, localpref 100, from 11.1.1.1
                      AS path: 64112 I, validation-state: unverified
                    > to 13.1.1.1 via fxp0.0
192.168.1.0/30     *[BGP/170] 00:14:27, localpref 100, from 11.1.1.1
                      AS path: 64112 64111 I, validation-state: unverified
                    > to 13.1.1.1 via fxp0.0

    </code></pre>
   

    <h3 class="note-subtitle">Tips Praktis</h3>
    <ul class="note-list">
      <li>Gunakan <strong>prefix-list</strong> dan <strong>route-map</strong> untuk mengontrol rute yang diumumkan/didapat.</li>
      <li>Monitor sesi BGP secara berkala untuk memastikan stabilitas.</li>
      <li>Hindari menerima seluruh tabel BGP kecuali benar-benar dibutuhkan.</li>
      <li>Gunakan <em>route reflector</em> pada IBGP untuk mengurangi kebutuhan full-mesh.</li>
    </ul>

    <hr class="note-divider" />

  </main>

  <script>
    document.querySelectorAll('.note-image').forEach(img => {
      img.addEventListener('click', () => {
        img.classList.toggle('expanded');
      });
    });
  </script>
</body>
</html>
